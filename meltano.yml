version: 1
default_environment: dev
project_id: 32d22b5f-1ecd-4da4-b543-e02ff074354b

environments:
  - name: dev
  - name: staging
  - name: prod

plugins:
  extractors:
    - name: tap-mssql
      variant: buzzcutnorman
      pip_url: git+https://github.com/BuzzCutNorman/tap-mssql.git
      config:
        host: ${TAP_MSSQL_HOST}
        port: ${TAP_MSSQL_PORT}
        user: ${TAP_MSSQL_USER}
        password: ${TAP_MSSQL_PASSWORD}
        database: ${TAP_MSSQL_DATABASE}

    - name: tap-rest-api-msdk
      variant: widen
      pip_url: tap-rest-api-msdk
      config:
        api_url: ${API_HOST}
        auth_method: "basic"
        username: ${API_USER}
        password: ${API_PASSWORD}
        pagination:
          pagination_type: offset
          page_param: offset
          page_size_param: limit
          start_page: 0
          limit: 100
        streams:
          - name: SalesOrderHeader
            path: /SalesOrderHeader
            key_properties: ["SalesOrderID"]
            records_path: data
            schema:
              type: object
              properties:
                SalesOrderID:
                  type: integer

          - name: SalesOrderDetail
            path: /SalesOrderDetail
            key_properties: ["SalesOrderID", "SalesOrderDetailID"]
            records_path: data
            schema:
              type: object
              properties:
                SalesOrderID:
                  type: integer
                SalesOrderDetailID:
                  type: integer

          - name: PurchaseOrderHeader
            path: /PurchaseOrderHeader
            key_properties: ["PurchaseOrderID"]
            records_path: data
            schema:
              type: object
              properties:
                PurchaseOrderID:
                  type: integer

          - name: PurchaseOrderDetail
            path: /PurchaseOrderDetail
            key_properties: ["PurchaseOrderID", "PurchaseOrderDetailID"]
            records_path: data
            schema:
              type: object
              properties:
                PurchaseOrderID:
                  type: integer
                PurchaseOrderDetailID:
                  type: integer

  loaders:
    - name: target-parquet-sqlserver
      inherit_from: target-parquet
      variant: automattic
      config:
        destination_path: output/sqlserver
        file_format: parquet
        data_flattening: 0
        encoding_errors: replace

    - name: target-parquet-api
      inherit_from: target-parquet
      variant: automattic
      pip_url: git+https://github.com/automattic/target-parquet.git
      config:
        destination_path: output/api2
        file_format: parquet
        encoding_errors: replace
