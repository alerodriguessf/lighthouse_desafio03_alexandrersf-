version: 1
default_environment: dev
project_id: 32d22b5f-1ecd-4da4-b543-e02ff074354b

environments:
  - name: dev
  - name: staging
  - name: prod

plugins:
  extractors:
    - name: tap-mssql
      variant: buzzcutnorman
      pip_url: git+https://github.com/BuzzCutNorman/tap-mssql.git
      config:
        host: ${TAP_MSSQL_HOST}
        port: ${TAP_MSSQL_PORT}
        user: ${TAP_MSSQL_USER}
        password: ${TAP_MSSQL_PASSWORD}
        database: ${TAP_MSSQL_DATABASE}

    - name: tap-rest-api-msdk
      variant: widen
      pip_url: tap-rest-api-msdk
      config:
        api_url: ${API_HOST}
        auth_method: "basic"
        username: ${API_USER}
        password: ${API_PASSWORD}
        streams:
          - name: SalesOrderHeader
            path: /SalesOrderHeader
          - name: SalesOrderDetail
            path: /SalesOrderDetail
          - name: PurchaseOrderHeader
            path: /PurchaseOrderHeader
          - name: PurchaseOrderDetail
            path: /PurchaseOrderDetail

  loaders:
    - name: target-parquet-sqlserver
      inherit_from: target-parquet
      variant: automattic
      config:
        destination_path: output/sqlserver
        file_format: parquet
        data_flattening: 0
        encoding_errors: replace

    - name: target-parquet-api
      inherit_from: target-parquet
      variant: automattic
      config:
        destination_path: output/api